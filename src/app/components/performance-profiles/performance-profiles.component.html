<div class="performance-container">
  <!-- Header -->
  <div class="header">
    <div>
      <h1>Performance Profiles</h1>
      <p>Manage job-specific KPI configurations and assignments</p>
    </div>
    <button class="btn-create" (click)="openModal()">+ Create Profile</button>
  </div>

  <!-- Layout -->
  <div class="profiles-layout">
    <!-- Left: Available Profiles -->
    <div class="profiles-list">
      <h2>Available Profiles</h2>
      <p class="subtitle">Click on a profile to view detailed configuration</p>

      <!-- Search + Filter -->

    <div class="table-wrap">
  <!-- Top controls: Search + Filters -->
  <div class="container-search">
    <span class="p-input-icon-left">
      <i class="pi pi-search search-i"></i>
      <input
        class="search-input"
        pInputText
        type="text"
        (input)="applyGlobalFilter($event, 'contains')"
        placeholder="Search Profile by Name..."
      />
    </span>

    <div class="dropdowns">
      <select
        [(ngModel)]="selectedStatus"
        (change)="dt.filter(selectedStatus, 'isActive', 'equals')"
      >
        <option value="">All Status</option>
        <option value="true">Active</option>
        <option value="false">Inactive</option>
      </select>

      <p-dropdown
        class="dropdown-container"
        [options]="[{label:'5', value:5},{label:'10', value:10},{label:'15', value:15}]"
        [(ngModel)]="rows"
        placeholder="Rows per page"
        (onChange)="dt.rows = rows; dt.reset()"
      ></p-dropdown>
    </div>
  </div>

  <!-- Table -->
  <p-table
    #dt
    [value]="performanceProfiles"
    [paginator]="true"
    [rows]="rows"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} profiles"
    [globalFilterFields]="['profileName','profileDescription','baseVariablePay']"
  >
    <!-- Headers -->
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="profileName">
          Profile Name <p-sortIcon field="profileName"></p-sortIcon>
        </th>
        <th>Levels</th>
        <th pSortableColumn="kpis">
          KPIs <p-sortIcon field="kpis"></p-sortIcon>
        </th>
        <th pSortableColumn="baseVariablePay">
          Variable Pay <p-sortIcon field="baseVariablePay"></p-sortIcon>
        </th>
        <th pSortableColumn="isActive">
          Status <p-sortIcon field="isActive"></p-sortIcon>
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <!-- Rows -->
    <ng-template pTemplate="body" let-profile>
      <tr>
        <td>
          <strong>{{ profile.profileName }}</strong>
          <p class="muted">{{ profile.profileDescription }}</p>
        </td>
        <td>
          {{ profile.departmentGradeMappings?.length
            ? profile.departmentGradeMappings[0].gradeLevel
            : 'N/A' }}
        </td>
        <td>{{ profile.kpiCount || 0 }} KPIs</td>
        <td>‚Çπ{{ profile.baseVariablePay | number }}</td>
        <td>
          <span [ngClass]="profile.isActive ? 'status active' : 'status inactive'">
            ‚óè {{ profile.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td>
          <p-overlayPanel #op styleClass="actions-overlay">
            <div class="action-options-container">
              <ng-container *ngFor="let option of actionOptions">
                <div
                  class="action-option-item"
                  (click)="selectAction(option, profile)"
                >
                  <span class="option-label">{{ option.label }}</span>
                </div>
              </ng-container>
            </div>
          </p-overlayPanel>

          <button
            pButton
            type="button"
            class="actions-button"
            (click)="op.toggle($event)"
          >
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </button>
        </td>
      </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center font-bold">No Performance Profiles Found</td>
      </tr>
    </ng-template>
  </p-table>
    </div>



    <!-- Right: Profile Details -->
    <div class="profile-details">
      <h2>Profile Details</h2>
      <p class="subtitle">View detailed configuration</p>

      <div class="profile-card">
        <div class="profile-header">
          <strong>Team Lead - L4</strong>
        </div>
        <div class="profile-info">
          <p><span>Description</span> Entry-level analyst responsible...</p>
          <p><span>Levels</span> L4</p>
          <p><span>Variable Pay</span> ‚Çπ1,000</p>
          <p><span>Status</span> <span class="status active">‚óè Active</span></p>
        </div>

        <h3>KPI Assignments</h3>
        <div class="kpi-assignments">
          <div class="kpi-box">
            <div>
              <strong>Claims Processing</strong>
              <p>Range: 0-100</p>
            </div>
            <strong>25%</strong>
          </div>
          <div class="kpi-box">
            <div>
              <strong>Claims Processing</strong>
              <p>Range: 0-100</p>
            </div>
            <strong>25%</strong>
          </div>
          <div class="kpi-box">
            <div>
              <strong>Claims Processing</strong>
              <p>Range: 0-100</p>
            </div>
            <strong>25%</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>











<!-- Create Profile Modal -->
<div class="modal-overlay" *ngIf="showCreateProfile" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Profile</h2>
    </div>

    <form [formGroup]="createProfileForm" (ngSubmit)="onCreateProfile()">
      <div class="modal-body">

        <!-- Basic Info -->
        <div class="form-row">
          <div class="form-group">
            <label>Profile Name <span class="required">*</span></label>
            <input type="text" formControlName="profileName" placeholder="e.g. Claims Denial Rate..." class="form-control" />
            <small class="error" *ngIf="isInvalid('profileName')">
              Profile name is required.
            </small>
          </div>

          <div class="form-group">
            <label>Description <span class="required">*</span></label>
            <input type="text" formControlName="profileDescription" placeholder="e.g. Percentage of claims denied..." class="form-control" />
            <!-- <small class="error" *ngIf="form.profileDescription.touched && form.profileDescription.invalid">
              Description is required.
            </small> -->
            <small class="error" *ngIf="isInvalid('profileDescription')">
              Description is required.
            </small>
          </div>
        </div>

        <!-- Department + Level -->
        <div class="form-row">
          <div class="form-group">
            <label>Department <span class="required">*</span></label>
            <div class="select-wrapper">
              <select class="form-control" formControlName="departmentId">
                <option value="">Select Department</option>
                <option *ngFor="let dept of departments" [value]="dept.id">
                  {{ dept.departmentName }}
                </option>
              </select>
            </div>
            <!-- <small class="error" *ngIf="form.departmentId.touched && form.departmentId.invalid"> -->
              <!-- Department is required. -->
            <!-- </small> -->
             <small class="error" *ngIf="isInvalid('departmentId')">
              Department is required.
            </small>
          </div>

          <div class="form-group">
            <label>Level <span class="required">*</span></label>
            <div class="select-wrapper">
              <select class="form-control" formControlName="gradeId">
                <option value="">Select Level</option>
                <option *ngFor="let lvl of levels" [value]="lvl.id">
                  {{ lvl.gradeLevel }} - {{ lvl.gradeName }}
                </option>
              </select>
            </div>
            <!-- <small class="error" *ngIf="form.gradeId.touched && form.gradeId.invalid"> -->
              <!-- Level is required. -->
            <!-- </small> -->

            <small class="error" *ngIf="isInvalid('gradeId')">
              Level is required.
            </small>
          </div>
        </div>

        <!-- KPI Assignments -->
        <div class="kpi-section">
          <h3>Add KPI to Profile</h3>

          <div formArrayName="kpiAssignments">
  <div *ngFor="let kpi of kpiAssignments.controls; let i = index" [formGroupName]="i" class="kpi-form-row">
    <select formControlName="kpiId" class="form-control">
      <option value="">Select KPI</option>
      <option *ngFor="let k of kpiMasterList" [value]="k.id">{{ k.kpiName }}</option>
    </select>

    <input type="number" formControlName="kpiMinRange" placeholder="Min" />
    <input type="number" formControlName="kpiMaxRange" placeholder="Max" />
    <input type="number" formControlName="kpiQualifyCriteria" placeholder="Qualify" />
    <input type="number" formControlName="weightage" placeholder="%" />

    <button type="button" (click)="addKpiAssignment()" *ngIf="i === kpiAssignments.length - 1">+</button>
    <button type="button" (click)="removeKpiAssignment(i)" *ngIf="kpiAssignments.length > 1">üóëÔ∏è</button>
  </div>
</div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-create" [disabled]="createProfileForm.invalid">
          Create Profile
        </button>
      </div>
    </form>
  </div>
</div>

